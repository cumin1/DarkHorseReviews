# Redis笔记

### Redis

redis是一个基于内存存储的nosql数据库，安装redis需要将安装包解压到linux某个目录中，然后手动启动redis-server命令。

解压完之后安装需要的依赖并且编译redis（因为redis底层是C实现的）

```bash
yum install -y gcc tcl
tar -xzf redis-6.2.6.tar.gz
cd redis-6.2.6
make && make install
```

编译完成可以试着启动一次：

```bash
cd /usr/local/bin
redis-server
```

安装完之后需要根据需求改几行配置文件：

```bash
# 这一行本来是127.0.0.1 意思是只能本地访问 改成0.0.0.0就可以远程访问这台主机的redis
bind 0.0.0.0  
# 守护进程 修改为yes之后就可以在后台运行
daemonize yes
# 密码 设置后访问redis需要输入密码
requirepass 123456
```

修改完配置文件需要在启动的时候指定配置文件才可以生效：

```bash
redis-server redis.conf

ps -ef | grep redis  # 启动之后可以通过这个命令看一下有没有成功运行
kill -9 进程id   # 通过这个命令可以停止这个进程
```

### 设置redis开机自启

首先需要创建一个系统文件

```bash
vi /etc/systemd/system/redis.service
```

内容:

```
[Unit]
Description=redis-server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

重载系统服务:

```bash
systemctl daemon-reload
systemctl start redis  # 启动redis
systemctl status redis # 看状态
systemctl stop redis 
systemctl restart redis
systemctl enable redis  # 设置开启自启redis
```

### redis-cli连接redis

-h 指定地址 默认 127.0.0.1

-p 指定端口 默认 6379

-a 指定密码

```bash
redis-cli -a 123456
```

### Springboot项目中使用SpringDataRedis

1.在pom.xml文件中引入依赖

```xml
<!--redis依赖-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<!--common-pool-->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-pool2</artifactId>
</dependency>
```

2.在yaml配置中配置必要的配置 （spring默认使用lettuce连接 如果要使用jedis的连接池需要额外引入pom）

```
spring:
  redis:
    host: 192.168.114.128
    port: 6379
    password: 123456
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: 100ms
```

3.配置SpringDataRedis的序列化方法(不然写入redis的东西都会经过jdk自带的序列化方法导致key、value名称混乱)

```java
@Configuration
public class RedisConfig {

    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory){
        // 创建RedisTemplate对象
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        // 设置连接工厂
        template.setConnectionFactory(connectionFactory);
        // 创建JSON序列化工具
        GenericJackson2JsonRedisSerializer jsonRedisSerializer = new GenericJackson2JsonRedisSerializer();
        // 设置Key的序列化
        template.setKeySerializer(RedisSerializer.string());
        template.setHashKeySerializer(RedisSerializer.string());
        // 设置Value的序列化
        template.setValueSerializer(jsonRedisSerializer);
        template.setHashValueSerializer(jsonRedisSerializer);
        // 返回
        return template;
    }
}
```

4.使用

```java
@Autowired
private RedisTemplate<String,Object> redisTemplate;
redisTemplate.opsForValue().set("name", "xiaohu");
Object name = redisTemplate.opsForValue().get("name");
```



# 黑马点评项目笔记

